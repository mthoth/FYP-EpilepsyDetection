# Import libraries
import numpy as np
from flask import Flask, request, jsonify, redirect, url_for, render_template
from joblib import load 
app = Flask(__name__)

# Load the model
model = load('epilepsyDetectionModel.pkl')

# A row from our dataset
data = [526.108992862438, 89.25809219915902, 112.92630698954454, 51.00053332348585, 382.4764649909828, 371.7430871693156, 51.18500441060907, 28.15177735412585, 1455.2734969098528, 225.33748958544237, 86.55663745453207, 48.026071538220634, 54.945245924923015, 19.10340898148834, 9.107385647474533, 2251.128771434709, 57.774253478654934, 16.271645526820443, 49.54886800827023, 39.20206369377378, 57.79179145074707, 3451.304832908901, 347.383058562819, 188.82119731574235, 28.15815545907114, 2397.664575831554, 435.3308277592571, 215.72425168118392, 52.51433195222921, 23.92618920369337, 8.405641834289428, 1083.6442384481431, 44.42417896647608, 23.683444055301692, 8.89930200206576, 582.1717923777112, 37.14275773279039, 5309.148137147653, 265.0067250466165, 102.65669020408421, 20.768415716189732, 20.762682221037473, 5.885136379994657, 4789.938930152741, 1122.9023243685149, 145.83642415991392, 26.42283429665238, 8.980007416289558, 221.18148164236547, 55.56673127364202, 60.337697152596704, 70.29743137584798, 187.4609466533936, 99.81887153864672, 52.79441322154637, 36.15408267313022, 14277.080491113917, 303.86252017500885, 135.06905406971305, 127.26476284850715, 68.31839218721935, 7734.796748381828, 839.2511079783861, 180.8608444952974, 83.37760785024041, 21.22735809219293, 18.54570044316838, 19.761016059042138, 1902.534102682375, 7.367726815413689, 16883.532648017695, 579.9491143797429, 8.388907093336316, 603.0518063913008, 98.60174215980084, 57.346338534243, 51.51580109990288, 236.7883027798357, 221.41344645804404, 39.032330007301084, 27.80449924892016, 2581.9764388274525, 320.93066006400744, 100.95467272403792, 69.40036285824918, 58.41951563552066, 19.1245820557926, 21.542023650919873, 6184.799891248602, 33.705576885444515, 11.069569100710863, 52.5463114879662, 32.92775259509193, 84.99985141053003, 2707.4339141735627, 304.0822615008984, 62.56574980399659, 10.131787644662952, 2956.693886820609, 677.688632333178, 106.81384942037832, 52.67113249464449, 36.549871026500625, 16.17453572607198, 198.05653076756573, 41.1386467144929, 15.021430021513044, 8.155920464760698, 792.0245794464547, 14.312540651890108, 5772.091095218603, 122.56912151083137, 119.94017359250091, 118.11499922767416, 16.43572658463356, 11.657645255369445, 3257.8368311835084, 286.07817769942653, 142.14644624149417, 138.26334714322468, 50.68084645375377, 74.00359886976344, 41.16531128828737, 37.55587053634237, 44.29964163059333, 216.04033384077334, 43.09674795923194, 62.86857559141028, 46.23505741676392, 10289.342920992143, 731.2179342288769, 167.85970247305877, 151.61337290970525, 165.96946924877201, 9453.184869926352, 132.05776381455948, 97.36872701468685, 149.2826109425742, 43.25395506846101, 39.18069149763609, 23.659529168600113, 1406.849808448971, 2.060691337813437, 2768.1979758291845, 474.3397619167693, 4.702287009028903, 345.6244524912425, 70.1833220246624, 22.999161780813033, 86.2231059614679, 241.19222493356435, 211.28599773436488, 61.33401157704063, 60.59378833899973, 1445.441668481176, 178.98989340700038, 73.50469452793293, 28.983182262384467, 23.879664883375966, 23.152171982831636, 16.983216573057057, 2732.8987819444246, 78.11652972589364, 11.015312400389895, 41.12996470982121, 31.710640271445794, 76.20698096354985, 3849.7583524078145, 405.42429812971596, 93.76310888655426, 18.87738296572556, 2095.4715571122824, 449.5374474278027, 79.10990319734593, 19.630904817929846, 7.014466278745697, 15.502775047519986, 207.65320820486937, 52.72889177405271, 18.785288981792256, 15.04290409029023, 4110.277870809873, 57.08570822595121, 4705.692857523789, 194.91334354158337, 108.12168958254638, 41.40018636948549, 14.843152930400292, 11.970403830949593, 4369.544169528257, 406.3392835522138, 158.03708476467955, 78.91219333737958, 21.109158281030986, 136.63835779801167, 60.93603030522293, 39.523549767220004, 56.5862921079741, 176.43648357583308, 86.70218994398914, 50.579564955824424, 56.382734273299306, 4715.607885094151, 716.9701672981824, 132.19962142478573, 122.58308687044519, 229.82380257236395, 10889.468687215185, 194.59073142673037, 287.6767196604419, 96.28946664900278, 98.79452840097372, 49.63747137757252, 25.447800400339805, 3724.285319138662, 6.811655627505772, 8861.294796980306, 534.0784254282995, 14.71944804164752]

@app.route('/')
def index():
    return render_template('index.html')


@app.route('/api',methods=['POST', "GET"])
def predict():
    if request.method == "POST":
        prediction = model.predict([np.array(data)])
        return redirect(url_for("display_prediction", view_prediction=prediction[0])) 
    else:
        return "nothing"    
    # return redirect(url_for("view_prediction", pred="output")) #jsonify(output)

@app.route('/<view_prediction>')
def display_prediction(view_prediction):
    return f"<h1>Prediction: {view_prediction}</h1>"
if __name__ == '__main__':
    app.run(port=5000, debug=True)

